"use strict";(self.webpackChunkhpc_doc_new=self.webpackChunkhpc_doc_new||[]).push([[8105],{2641:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>t,metadata:()=>c,toc:()=>r});var o=i(4848),a=i(8453);const t={title:"Conda Enviroments",sidebar_position:1},s=void 0,c={id:"running-jobs/conda",title:"Conda Enviroments",description:"Conda is a package management environment and package manager that is primarily used for open-source software packages. Conda is associated with Python and R programming languages but also supports C++ and Fortran.",source:"@site/docs/running-jobs/conda.mdx",sourceDirName:"running-jobs",slug:"/running-jobs/conda",permalink:"/hpc_doc_new/docs/running-jobs/conda",draft:!1,unlisted:!1,editUrl:"https://github.com/amirayuyue/hpc_doc_new/docs/running-jobs/conda.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"Conda Enviroments",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Building and Compiling GPU based Softwares and Applications",permalink:"/hpc_doc_new/docs/running-jobs/build_gpu_apps"},next:{title:"Running Interactive Jobs",permalink:"/hpc_doc_new/docs/running-jobs/interact_job"}},d={},r=[{value:"Build your own conda environment",id:"build-your-own-conda-environment",level:2},{value:"Load and initializing conda",id:"load-and-initializing-conda",level:3},{value:"Optional -- Editing the <code>.condarc</code> file",id:"optional----editing-the-condarc-file",level:3},{value:"Installing and activating a <code>conda</code> environment",id:"installing-and-activating-a-conda-environment",level:3},{value:"Using Anaconda in SLURM job scripts",id:"using-anaconda-in-slurm-job-scripts",level:3},{value:"Common Issues with Conda",id:"common-issues-with-conda",level:3}];function l(n){const e={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.p,{children:"Conda is a package management environment and package manager that is primarily used for open-source software packages. Conda is associated with Python and R programming languages but also supports C++ and Fortran."}),"\n",(0,o.jsx)(e.p,{children:"Below is documentation on installing and maintaining a Conda environment on the HPC clusters."}),"\n",(0,o.jsx)(e.h2,{id:"build-your-own-conda-environment",children:"Build your own conda environment"}),"\n",(0,o.jsx)(e.h3,{id:"load-and-initializing-conda",children:"Load and initializing conda"}),"\n",(0,o.jsxs)(e.p,{children:["If you have not ran ",(0,o.jsx)(e.code,{children:"conda init"})," to add it as a source in your ",(0,o.jsx)(e.code,{children:".bashrc"})," file, then this is a necessary first step to use Conda.\nOnce users log into the HPC system, you need to type the following command:"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{children:"module load anaconda3\nconda init\n"})}),"\n",(0,o.jsx)(e.admonition,{type:"note",children:(0,o.jsxs)(e.p,{children:["if you get a warning messages after ",(0,o.jsx)(e.code,{children:"conda init"})," command, you need to log out the HPC system, and then log back in. You will then be able to initialize the system. Once the conda environment is initialized, you will see the environment name (default one is called ",(0,o.jsx)(e.code,{children:"base"}),") next be listed next to your username in the command line."]})}),"\n",(0,o.jsxs)(e.h3,{id:"optional----editing-the-condarc-file",children:["Optional -- Editing the ",(0,o.jsx)(e.code,{children:".condarc"})," file"]}),"\n",(0,o.jsxs)(e.p,{children:["By default,  conda stores packages in the ",(0,o.jsx)(e.code,{children:"HOME"})," directory. If you want to change the default path to somewhere you desire, for example ",(0,o.jsx)(e.code,{children:"/data/$USER/"}),", you can use a text editor to create a file called ",(0,o.jsx)(e.code,{children:".condarc"})," under the path ",(0,o.jsx)(e.code,{children:"/home/$USER/.condarc"})," and it should contain the path to the alternative location."]}),"\n",(0,o.jsx)(e.p,{children:"e.g.:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{children:"pkgs_dirs:\n - /data/$USER/conda/pkgs\n"})}),"\n",(0,o.jsx)(e.admonition,{type:"tip",children:(0,o.jsxs)(e.p,{children:["More ",(0,o.jsx)(e.code,{children:".condarc"})," examples can be found ",(0,o.jsx)(e.a,{href:"https://conda.io/projects/conda/en/latest/user-guide/configuration/use-condarc.html",children:"here"})]})}),"\n",(0,o.jsxs)(e.h3,{id:"installing-and-activating-a-conda-environment",children:["Installing and activating a ",(0,o.jsx)(e.code,{children:"conda"})," environment"]}),"\n",(0,o.jsxs)(e.p,{children:["To create and install a ",(0,o.jsx)(e.code,{children:"conda"})," environment, you can specify a prefix, which will be the path to where the environment will be installed. If you don't include ",(0,o.jsx)(e.code,{children:"prefix"}),", the default path will be under your ",(0,o.jsx)(e.code,{children:"HOME"}),".  Choose a descriptive name for the environment- Conda will create the directory, the directory should not already exist.\nFor example, if you want to create a conda environment called ",(0,o.jsx)(e.code,{children:"env_aaa"})," containing the packages ",(0,o.jsx)(e.code,{children:"AAA, BBB, CCC"}),", and insatll it in the directory ",(0,o.jsx)(e.code,{children:"/data/$USER/packages"}),", you can do following"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"conda create --prefix /data/$USER/packages/env_aaa AAA BBB CCC\n"})}),"\n",(0,o.jsx)(e.p,{children:"To activate the environment, you can do:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"conda activate /data/$USER/packages/env_aaa\n"})}),"\n",(0,o.jsx)(e.admonition,{type:"note",children:(0,o.jsx)(e.p,{children:"If you are using the default package path, you do not need to include path to activate the environment, you can just do:"})}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"conda activate ENV_NAME\n"})}),"\n",(0,o.jsxs)(e.admonition,{type:"note",children:[(0,o.jsx)(e.mdxAdmonitionTitle,{}),(0,o.jsxs)(e.p,{children:["User can also create a ",(0,o.jsx)(e.code,{children:"YAML"})," file with all of the desired conda packages so that conda will find the correct configuration to solve the environment.\nThe ",(0,o.jsx)(e.code,{children:"YAML"})," file will contain a name, a list of Conda channels to look for the packages, and a list of all the desired packages."]})]}),"\n",(0,o.jsxs)(e.p,{children:["Here are some sample ",(0,o.jsx)(e.code,{children:"YAML"})," files:"]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:(0,o.jsx)(e.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:i(5091).A+"",title:":ignore",children:"datascience.yml"})})," - Contains many common data science programs"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:(0,o.jsx)(e.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:i(7301).A+"",title:":ignore",children:"sklearn.yml"})})," - Machine learning with scikit-learn"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:(0,o.jsx)(e.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:i(5520).A+"",title:":ignore",children:"biotools.yml"})})," - Contains applications for a bioinformatics workflow"]}),"\n"]}),"\n",(0,o.jsx)(e.h3,{id:"using-anaconda-in-slurm-job-scripts",children:"Using Anaconda in SLURM job scripts"}),"\n",(0,o.jsx)(e.p,{children:"Conda does not know the source when it is called in a SLURM job script.\nTo ensure conda knows the source of the environment that it will be activating during the execution of the SLURM job script activate the conda environment by running:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"source activate <env name>`\n"})}),"\n",(0,o.jsx)(e.p,{children:"This will ensure SLURM to look for the called environment in the correct PATH and activates it."}),"\n",(0,o.jsx)(e.p,{children:"An example job script utilizing a conda environment can be found ADD LINK HERE"}),"\n",(0,o.jsx)(e.admonition,{type:"warning",children:(0,o.jsxs)(e.p,{children:["Note using ",(0,o.jsx)(e.code,{children:"conda activate <env name>"})," may result in error as ",(0,o.jsx)(e.code,{children:"conda activate "}),"makes the assumption that the environment is being called in the same PATH it exists, which is not the case for SLURM jobs."]})}),"\n",(0,o.jsx)(e.h3,{id:"common-issues-with-conda",children:"Common Issues with Conda"}),"\n",(0,o.jsxs)(e.p,{children:["Without running ",(0,o.jsx)(e.code,{children:"conda init"})," the commands ",(0,o.jsx)(e.code,{children:"conda activate"})," and ",(0,o.jsx)(e.code,{children:"conda deactivate"})," will present the following warning."]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"[tester001@rclogin01 ~]$ conda activate\nCommandNotFoundError: Your shell has not been properly configured to use 'conda activate'.\nTo initialize your shell, run\n\n    $ conda init <SHELL_NAME>\n\nCurrently supported shells are:\n- bash\n- fish\n- tcsh\n- xonsh\n- zsh\n- powershell\n\nSee 'conda init --help' for more information and options.\n\nIMPORTANT: You may need to close and restart your shell after running 'conda init'.\n\n"})}),"\n",(0,o.jsxs)(e.p,{children:["Since ",(0,o.jsx)(e.code,{children:"conda init"})," injects some logic into your .bashrc file it must be sourced. For interactive job sessions ",(0,o.jsx)(e.code,{children:"conda init"})," does not need to be called as the source is already known. However this is not the case for SLURM jobs,  therefore it is important to add ",(0,o.jsx)(e.code,{children:"source .bashrc"})," to the submission script to allow subsequent conda activate or conda deactivate commands to work."]})]})}function h(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(l,{...n})}):l(n)}},5520:(n,e,i)=>{i.d(e,{A:()=>o});const o=i.p+"assets/files/biotools-ab281b4389cbc147fc28d14180142abd.yml"},5091:(n,e,i)=>{i.d(e,{A:()=>o});const o=i.p+"assets/files/datascience-3342bc50216e571d28515b20d4158051.yml"},7301:(n,e,i)=>{i.d(e,{A:()=>o});const o=i.p+"assets/files/sklearn-c5608aad942da2aafd2c313e771e3a1f.yml"},8453:(n,e,i)=>{i.d(e,{R:()=>s,x:()=>c});var o=i(6540);const a={},t=o.createContext(a);function s(n){const e=o.useContext(t);return o.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:s(n.components),o.createElement(t.Provider,{value:e},n.children)}}}]);