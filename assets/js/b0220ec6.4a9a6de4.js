"use strict";(self.webpackChunkhpc_doc_new=self.webpackChunkhpc_doc_new||[]).push([[8271],{7731:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>l,default:()=>p,frontMatter:()=>i,metadata:()=>c,toc:()=>d});var r=t(4848),o=t(8453),s=(t(6012),t(1470)),a=t(9365);const i={title:"Running Common Applications",sidebar_position:3},l="Running Common Applications on Pinnacles and MERCED",c={id:"HPC-clusters/run_apps",title:"Running Common Applications",description:"Running Quantum ESPRESSO",source:"@site/docs/HPC-clusters/run_apps.md",sourceDirName:"HPC-clusters",slug:"/HPC-clusters/run_apps",permalink:"/hpc_doc_new/docs/HPC-clusters/run_apps",draft:!1,unlisted:!1,editUrl:"https://github.com/amirayuyue/hpc_doc_new/docs/HPC-clusters/run_apps.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Running Common Applications",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Job Management",permalink:"/hpc_doc_new/docs/HPC-clusters/job_manage"},next:{title:"HPC Support",permalink:"/hpc_doc_new/docs/HPC-clusters/get_help"}},u={},d=[{value:"Running Quantum ESPRESSO",id:"running-quantum-espresso",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"running-common-applications-on-pinnacles-and-merced",children:"Running Common Applications on Pinnacles and MERCED"})}),"\n",(0,r.jsx)(n.h2,{id:"running-quantum-espresso",children:"Running Quantum ESPRESSO"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://www.quantum-espresso.org/",children:"Quantum ESPRESSO"})," is a group of codes that is used to compute the microscopic properties of materials and molecules at the atomic levels using density functional theory. The core codes of Quantum ESPRESSO are parallelizable and require large amounts of memory making them the perfect candidates for high performance computing. This article is written to understanding the nuances of using Quantum ESPRESSO on MERCED. To follow a tutorial on Quantum ESPRESSO, follow one of the links on this ",(0,r.jsx)(n.a,{href:"https://www.quantum-espresso.org/tutorials/",children:"page"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Below is an example job script and ",(0,r.jsx)(n.code,{children:"pw.x"})," input file for bilayer MoS2. For details on the input parameters of ",(0,r.jsx)(n.code,{children:"pw.x"}),", see the Quantum ESPRESSO official documentation."]}),"\n",(0,r.jsxs)(n.p,{children:["The job script contains a few ",(0,r.jsx)(n.code,{children:"sbatch"})," options that are specific to parallel computations of this type. First, we are using 1 node, but all 24 cores via the nodes and ",(0,r.jsx)(n.code,{children:"ntasks-per-node"})," options. ",(0,r.jsx)(n.code,{children:"--constraint=ib"})," is a special setting that restricts the nodes chosen to use the faster infiniband connection which is suitable for parallel computing (This is only applicatable for MERCED since Pinnacles nodes are interconnected with IB). ",(0,r.jsx)(n.code,{children:"--exclusive"})," is used when occupying an entire node and ensures that no other jobs will run on the node and cause problems for the parallel job. Do not use ",(0,r.jsx)(n.code,{children:"--exclusive"})," when using a smaller number of cores than what exists on the node, as this lowers the cluster's efficiency. ",(0,r.jsx)(n.code,{children:"--mem=0"})," is an option which specifies that the job is using the ",(0,r.jsx)(n.strong,{children:"entire node's memory"}),". This again should only be set when occupying the entire node. This option can be set to a reasonable value should the entire node not be used. Quantum ESPRESSO estimates the memory usage, so a test computation can be run and the following message will appear: Estimated total dynamical RAM > 3.25 GB. In this case, the user may set ",(0,r.jsx)(n.code,{children:"--mem=5G"})," to give some memory headroom."]}),"\n",(0,r.jsxs)(n.p,{children:["The job begins by loading ",(0,r.jsx)(n.code,{children:"Quantum ESPRESSO v6.6"})," using ",(0,r.jsx)(n.code,{children:"module load"}),". To search for the available versions, run ",(0,r.jsx)(n.code,{children:"module avail quantum-espresso"})," in the command line."]}),"\n",(0,r.jsxs)(n.p,{children:["The next set of lines link the ",(0,r.jsx)(n.code,{children:"pseudopotential"})," files to the current working directory, ",(0,r.jsx)(n.code,{children:"./"}),". In this scheme, the directory ",(0,r.jsx)(n.code,{children:"${HOME}/PPs"})," has been created by the user and pseudopotential files (.upf) have been stored into it. Those lines are linked to ",(0,r.jsx)(n.code,{children:"./"})," and are then read by ESPRESSO in the line ",(0,r.jsx)(n.code,{children:"pseudo_dir='./'"}),". They are then ascribed to the atom under the ",(0,r.jsx)(n.code,{children:"ATOMIC_SPECIES"})," card."]}),"\n",(0,r.jsxs)(n.p,{children:["The job script then sets the variable ",(0,r.jsx)(n.code,{children:"nCores"})," to be the total number of cores expected to be used, and runs ",(0,r.jsx)(n.code,{children:"pw.x"})," in parallel using ",(0,r.jsx)(n.code,{children:"mpirun"}),". It takes the file ",(0,r.jsx)(n.code,{children:"moS2.scf.in"})," as input and saves it (along with errors &>) to the file ",(0,r.jsx)(n.code,{children:"moS2.scf"}),".out. The ",(0,r.jsx)(n.code,{children:"-nk 12"})," option to ",(0,r.jsx)(n.code,{children:"pw.x"}),' is one of the parallelization levels employed by ESPRESSO--specifically the "pools" option that parallelizes across 12 groups of k-points.']}),"\n",(0,r.jsxs)(s.A,{children:[(0,r.jsx)(a.A,{value:"QE Job Script",label:"Quantom Expresso Job Script",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"#!/usr/bin/env bash\n\n#SBATCH --job-name=QE_EXAMPLE\n#SBATCH --partition=test\n#SBATCH -M merced\n#SBATCH --nodes=1\n#SBATCH --ntasks-per-node=20\n#SBATCH --time=00:30:00\n#SBATCH --constraint=ib\n#SBATCH --exclusive\n#SBATCH --mem=0\n\nmodule load mvapich2-2.2/intel\nmodule load quantum-espresso/6.6\n\nnCores=${SLURM_NTASKS}\nmpirun -n $nCores pw.x -nk 12 < moS2.scf.in &> moS2.scf.out\n"})})}),(0,r.jsx)(a.A,{value:"`pw.x` input",label:"Example of `pw.x` input",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"&CONTROL\n    calculation = 'scf'\n    pseudo_dir  = './'\n    outdir       = './'\n    prefix = 'moS2'\n    tprnfor = .true.\n    tstress = .true.\n    etot_conv_thr = 1.0D-8\n    forc_conv_thr = 1.0D-5\n/\n\n&SYSTEM\n    ibrav       = 0,\n    ecutwfc     = 60,\n    nat         = 6,\n    ntyp        = 2,\n/\n\n&ELECTRONS\n    conv_thr         =  1.00000e-10\n/\n\nK_POINTS {automatic}\n6 6 1 1 1 0\n\nATOMIC_SPECIES\nMo     95.94000  Mo_ONCV_PBE-1.0.upf\nS      32.06600  S_ONCV_PBE-1.0.upf\n\nCELL_PARAMETERS (angstrom)\n   3.190560000   0.000000000   0.000000000\n  -1.595280000   2.763110000   0.000000000\n   0.000000000   0.000000000  25.000000000\n\nATOMIC_POSITIONS (angstrom)\nS        1.595280002   0.920977084   1.539433305\nMo       3.190559998   1.842097452   3.098045063\nS        1.595280002   0.920977074   4.656657474\nS        3.19056   1.842132926   7.735684114\nMo       1.59528   0.921012548   9.294296525\nS        3.19056   1.842132916  10.852908283\n"})})})]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},9365:(e,n,t)=>{t.d(n,{A:()=>a});t(6540);var r=t(4164);const o={tabItem:"tabItem_Ymn6"};var s=t(4848);function a(e){let{children:n,hidden:t,className:a}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,r.A)(o.tabItem,a),hidden:t,children:n})}},1470:(e,n,t)=>{t.d(n,{A:()=>E});var r=t(6540),o=t(4164),s=t(3104),a=t(6347),i=t(205),l=t(7485),c=t(1682),u=t(679);function d(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:t}=e;return(0,r.useMemo)((()=>{const e=n??function(e){return d(e).map((e=>{let{props:{value:n,label:t,attributes:r,default:o}}=e;return{value:n,label:t,attributes:r,default:o}}))}(t);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function p(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:t}=e;const o=(0,a.W6)(),s=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,l.aZ)(s),(0,r.useCallback)((e=>{if(!s)return;const n=new URLSearchParams(o.location.search);n.set(s,e),o.replace({...o.location,search:n.toString()})}),[s,o])]}function f(e){const{defaultValue:n,queryString:t=!1,groupId:o}=e,s=h(e),[a,l]=(0,r.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const r=t.find((e=>e.default))??t[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:s}))),[c,d]=m({queryString:t,groupId:o}),[f,b]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[o,s]=(0,u.Dv)(t);return[o,(0,r.useCallback)((e=>{t&&s.set(e)}),[t,s])]}({groupId:o}),g=(()=>{const e=c??f;return p({value:e,tabValues:s})?e:null})();(0,i.A)((()=>{g&&l(g)}),[g]);return{selectedValue:a,selectValue:(0,r.useCallback)((e=>{if(!p({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),b(e)}),[d,b,s]),tabValues:s}}var b=t(2303);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var S=t(4848);function x(e){let{className:n,block:t,selectedValue:r,selectValue:a,tabValues:i}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,s.a_)(),u=e=>{const n=e.currentTarget,t=l.indexOf(n),o=i[t].value;o!==r&&(c(n),a(o))},d=e=>{let n=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const t=l.indexOf(e.currentTarget)+1;n=l[t]??l[0];break}case"ArrowLeft":{const t=l.indexOf(e.currentTarget)-1;n=l[t]??l[l.length-1];break}}n?.focus()};return(0,S.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.A)("tabs",{"tabs--block":t},n),children:i.map((e=>{let{value:n,label:t,attributes:s}=e;return(0,S.jsx)("li",{role:"tab",tabIndex:r===n?0:-1,"aria-selected":r===n,ref:e=>l.push(e),onKeyDown:d,onClick:u,...s,className:(0,o.A)("tabs__item",g.tabItem,s?.className,{"tabs__item--active":r===n}),children:t??n},n)}))})}function v(e){let{lazy:n,children:t,selectedValue:s}=e;const a=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=a.find((e=>e.props.value===s));return e?(0,r.cloneElement)(e,{className:(0,o.A)("margin-top--md",e.props.className)}):null}return(0,S.jsx)("div",{className:"margin-top--md",children:a.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==s})))})}function j(e){const n=f(e);return(0,S.jsxs)("div",{className:(0,o.A)("tabs-container",g.tabList),children:[(0,S.jsx)(x,{...n,...e}),(0,S.jsx)(v,{...n,...e})]})}function E(e){const n=(0,b.A)();return(0,S.jsx)(j,{...e,children:d(e.children)},String(n))}},6012:(e,n,t)=>{t.d(n,{A:()=>o});t(6540);var r=t(4848);function o(e){let{children:n,color:t}=e;return(0,r.jsx)("span",{style:{backgroundColor:t,borderRadius:"4px",color:"#fff",padding:"0.2rem 0.5rem",fontWeight:"bold"},children:n})}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>i});var r=t(6540);const o={},s=r.createContext(o);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);