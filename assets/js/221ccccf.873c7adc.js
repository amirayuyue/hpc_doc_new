"use strict";(self.webpackChunkhpc_doc_new=self.webpackChunkhpc_doc_new||[]).push([[6750],{8962:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>c,toc:()=>d});var r=t(4848),s=t(8453),o=(t(6012),t(1470)),a=t(9365);const i={title:"Running Common Applications",sidebar_position:3},l="Running Quantum ESPRESSO",c={id:"hpcdocs/HPC-clusters/run_apps",title:"Running Common Applications",description:"Quantum ESPRESSO is a group of codes that is used to compute the microscopic properties of materials and molecules at the atomic levels using density functional theory. The core codes of Quantum ESPRESSO are parallelizable and require large amounts of memory making them the perfect candidates for high performance computing. This article is written to understanding the nuances of using Quantum ESPRESSO on Pinnacles and MERCED. To follow a tutorial on Quantum ESPRESSO, follow one of the links on this page.",source:"@site/docs/hpcdocs/HPC-clusters/run_apps.md",sourceDirName:"hpcdocs/HPC-clusters",slug:"/hpcdocs/HPC-clusters/run_apps",permalink:"/hpc_doc_new/docs/hpcdocs/HPC-clusters/run_apps",draft:!1,unlisted:!1,editUrl:"https://github.com/amirayuyue/hpc_doc_new/docs/hpcdocs/HPC-clusters/run_apps.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Running Common Applications",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Job Management",permalink:"/hpc_doc_new/docs/hpcdocs/HPC-clusters/job_manage"},next:{title:"HPC Support",permalink:"/hpc_doc_new/docs/hpcdocs/HPC-clusters/get_help"}},u={},d=[{value:"Job Script for Bilayer MoS\u2082",id:"job-script-for-bilayer-mos",level:3},{value:"SLURM Batch Script Tutorial",id:"slurm-batch-script-tutorial",level:3}];function p(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"running-quantum-espresso",children:"Running Quantum ESPRESSO"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://www.quantum-espresso.org/",children:"Quantum ESPRESSO"})," is a group of codes that is used to compute the microscopic properties of materials and molecules at the atomic levels using density functional theory. The core codes of Quantum ESPRESSO are parallelizable and require large amounts of memory making them the perfect candidates for high performance computing. This article is written to understanding the nuances of using Quantum ESPRESSO on Pinnacles and MERCED. To follow a tutorial on Quantum ESPRESSO, follow one of the links on this ",(0,r.jsx)(n.a,{href:"https://www.quantum-espresso.org/tutorials/",children:"page"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"job-script-for-bilayer-mos",children:"Job Script for Bilayer MoS\u2082"}),"\n",(0,r.jsx)(n.p,{children:"Below is an example job script and input file for running pw.x on bilayer MoS\u2082. Refer to the Quantum ESPRESSO documentation for details on pw.x input parameters."}),"\n",(0,r.jsx)(n.h3,{id:"slurm-batch-script-tutorial",children:"SLURM Batch Script Tutorial"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Node and Task Allocation: Use ",(0,r.jsx)(n.code,{children:"--nodes=1"})," and ",(0,r.jsx)(n.code,{children:"--ntasks-per-node=24"})," to utilize  24 cores on a single node.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"This can be extended to any number of nodes and cores for scalability of the experiment."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Exclusive Access: Use ",(0,r.jsx)(n.code,{children:"--exclusive"})," to reserve the entire node.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Avoid if using fewer than the node's full core count."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Memory Allocation: Set ",(0,r.jsx)(n.code,{children:"--mem=0"}),' to access all node memory, or specify a value (e.g., --mem=5G) if not using the entire node. Quantum ESPRESSO outputs memory requirements (e.g., "Estimated total dynamical RAM > 3.25 GB") in test runs.']}),"\n",(0,r.jsx)(n.li,{children:"Load the default Quantum ESPRESSO module version (quantum-espresso/7.2-gcc-openblas) with:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"module load quantum-espresso\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"To view all versions of Quantum ESPRESSO available use:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"module avail quantum-espresso\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The next set of lines link the ",(0,r.jsx)(n.code,{children:"pseudopotential"})," files to the current working directory, ",(0,r.jsx)(n.code,{children:"./"}),". In this scheme, the directory ",(0,r.jsx)(n.code,{children:"${HOME}/PPs"})," has been created by the user and pseudopotential files (.upf) have been stored into it. Those lines are linked to ",(0,r.jsx)(n.code,{children:"./"})," and are then read by ESPRESSO in the line ",(0,r.jsx)(n.code,{children:"pseudo_dir='./'"}),". They are then ascribed to the atom under the ",(0,r.jsx)(n.code,{children:"ATOMIC_SPECIES"})," card."]}),"\n",(0,r.jsxs)(n.p,{children:["The job script then sets the variable ",(0,r.jsx)(n.code,{children:"nCores"})," to be the total number of cores expected to be used, and runs ",(0,r.jsx)(n.code,{children:"pw.x"})," in parallel using ",(0,r.jsx)(n.code,{children:"mpirun"}),". It takes the file ",(0,r.jsx)(n.code,{children:"moS2.scf.in"})," as input and saves it (along with errors &>) to the file ",(0,r.jsx)(n.code,{children:"moS2.scf"}),".out. The ",(0,r.jsx)(n.code,{children:"-nk 12"})," option to ",(0,r.jsx)(n.code,{children:"pw.x"}),' is one of the parallelization levels employed by ESPRESSO--specifically the "pools" option that parallelizes across 12 groups of k-points.']}),"\n",(0,r.jsxs)(o.A,{children:[(0,r.jsx)(a.A,{value:"QE Job Script",label:"Quantom Expresso Job Script",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"#!/usr/bin/env bash\n#SBATCH --job-name=QE_EXAMPLE\n#SBATCH --partition=test\n#SBATCH --nodes=1\n#SBATCH --ntasks-per-node=20\n#SBATCH --time=00:30:00\n#SBATCH --mem=0\n#SBATCH --output=qe_test%j.qlog\n\nmodule load openmpi/4.1.1-gcc-8.4.1\nmodule load quantum-espresso/7.2-gcc-openblas\n\nnCores=${SLURM_NTASKS}\nmpirun -n $nCores pw.x  < moS2.scf.in &> moS2.scf.out\n# mpirun -n $nCores pw.x -nk 12  < moS2.scf.in &> moS2.scf.out \n# If setting the pools properly in the input files for parallelism\n"})})}),(0,r.jsx)(a.A,{value:"`pw.x` input",label:"Example of `pw.x` input",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"&CONTROL\n    calculation = 'scf'\n    pseudo_dir  = './'\n    outdir       = './'\n    prefix = 'moS2'\n    tprnfor = .true.\n    tstress = .true.\n    etot_conv_thr = 1.0D-8\n    forc_conv_thr = 1.0D-5\n/\n\n&SYSTEM\n    ibrav       = 0,\n    ecutwfc     = 60,\n    nat         = 6,\n    ntyp        = 2,\n/\n\n&ELECTRONS\n    conv_thr         =  1.00000e-10\n/\n\nK_POINTS {automatic}\n6 6 1 1 1 0\n\nATOMIC_SPECIES\nMo     95.94000  Mo_ONCV_PBE-1.0.upf\nS      32.06600  Sc_ONCV_PBE-1.0.oncvpsp.upf\n\nCELL_PARAMETERS (angstrom)\n   3.190560000   0.000000000   0.000000000\n  -1.595280000   2.763110000   0.000000000\n   0.000000000   0.000000000  25.000000000\n\nATOMIC_POSITIONS (angstrom)\nS        1.595280002   0.920977084   1.539433305\nMo       3.190559998   1.842097452   3.098045063\nS        1.595280002   0.920977074   4.656657474\nS        3.19056   1.842132926   7.735684114\nMo       1.59528   0.921012548   9.294296525\nS        3.19056   1.842132916  10.852908283\n"})})})]}),"\n",(0,r.jsxs)(n.admonition,{type:"warning",children:[(0,r.jsxs)(n.p,{children:["Quantum ESPRESSO Requires the ",(0,r.jsx)(n.code,{children:"upf"})," files to be loaded before running the experiment."]}),(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"upf"})," files can be downloaded from ",(0,r.jsx)(n.a,{href:"https://www.materialscloud.org/discover/sssp/table/efficiency#sssp-license",children:"SSSP page"})]})]}),"\n",(0,r.jsx)(n.p,{children:"Here are the input files neccessary to run this tutorial."}),"\n",(0,r.jsxs)(o.A,{children:[(0,r.jsx)(a.A,{value:"moS2.scf.in",label:"`moS2.scf.in` Input",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"&CONTROL\n    calculation   = 'scf',\n    restart_mode  = 'from_scratch',\n    pseudo_dir    = './',\n    prefix        = 'MoS2',\n    outdir        = './',\n    nstep         = 100,\n/\n\n&SYSTEM\n    ibrav         = 4,\n    a             = 3.16000e+00,\n    c             = 2.00000e+01,\n    nat           = 3,\n    ntyp          = 2,\n    ecutwfc       = 60,\n    occupations   = 'fixed',\n    smearing      = 'gauss',\n    vdw_corr      = 'DFT-D',\n/\n\n&ELECTRONS\n    conv_thr      = 1.0d-9,\n/\n\nATOMIC_SPECIES\n    Mo     95.94000  Mo_ONCV_PBE-1.0.upf\n    S      32.06600  Sc_ONCV_PBE-1.0.oncvpsp.upf\n\nATOMIC_POSITIONS (angstrom)\n    S        0.002804304   0.001613133   8.429890591\n    S        0.002804304   0.001613133  11.570109409\n    Mo       1.582007393   0.913365735  10.000000000\n\nK_POINTS automatic\n    51 51 1 0 0 0\n"})})}),(0,r.jsx)(a.A,{value:"`Sc_ONCV_PBE-1.0.oncvpsp.upf` input",label:"`Sc_ONCV_PBE-1.0.oncvpsp.upf` Input",children:(0,r.jsxs)(n.p,{children:["The contents of the file is long, please download ",(0,r.jsx)(n.code,{children:"Sc_ONCV_PBE-1.0.oncvpsp.upf"})," from the ",(0,r.jsx)(n.a,{href:"https://www.materialscloud.org/discover/sssp/table/efficiency#sssp-license",children:"SSSP page"})]})})]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},9365:(e,n,t)=>{t.d(n,{A:()=>a});t(6540);var r=t(4164);const s={tabItem:"tabItem_Ymn6"};var o=t(4848);function a(e){let{children:n,hidden:t,className:a}=e;return(0,o.jsx)("div",{role:"tabpanel",className:(0,r.A)(s.tabItem,a),hidden:t,children:n})}},1470:(e,n,t)=>{t.d(n,{A:()=>E});var r=t(6540),s=t(4164),o=t(3104),a=t(6347),i=t(205),l=t(7485),c=t(1682),u=t(679);function d(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:n,children:t}=e;return(0,r.useMemo)((()=>{const e=n??function(e){return d(e).map((e=>{let{props:{value:n,label:t,attributes:r,default:s}}=e;return{value:n,label:t,attributes:r,default:s}}))}(t);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function h(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:t}=e;const s=(0,a.W6)(),o=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,l.aZ)(o),(0,r.useCallback)((e=>{if(!o)return;const n=new URLSearchParams(s.location.search);n.set(o,e),s.replace({...s.location,search:n.toString()})}),[o,s])]}function f(e){const{defaultValue:n,queryString:t=!1,groupId:s}=e,o=p(e),[a,l]=(0,r.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!h({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const r=t.find((e=>e.default))??t[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:o}))),[c,d]=m({queryString:t,groupId:s}),[f,S]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[s,o]=(0,u.Dv)(t);return[s,(0,r.useCallback)((e=>{t&&o.set(e)}),[t,o])]}({groupId:s}),b=(()=>{const e=c??f;return h({value:e,tabValues:o})?e:null})();(0,i.A)((()=>{b&&l(b)}),[b]);return{selectedValue:a,selectValue:(0,r.useCallback)((e=>{if(!h({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),S(e)}),[d,S,o]),tabValues:o}}var S=t(2303);const b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=t(4848);function g(e){let{className:n,block:t,selectedValue:r,selectValue:a,tabValues:i}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,o.a_)(),u=e=>{const n=e.currentTarget,t=l.indexOf(n),s=i[t].value;s!==r&&(c(n),a(s))},d=e=>{let n=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const t=l.indexOf(e.currentTarget)+1;n=l[t]??l[0];break}case"ArrowLeft":{const t=l.indexOf(e.currentTarget)-1;n=l[t]??l[l.length-1];break}}n?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":t},n),children:i.map((e=>{let{value:n,label:t,attributes:o}=e;return(0,x.jsx)("li",{role:"tab",tabIndex:r===n?0:-1,"aria-selected":r===n,ref:e=>l.push(e),onKeyDown:d,onClick:u,...o,className:(0,s.A)("tabs__item",b.tabItem,o?.className,{"tabs__item--active":r===n}),children:t??n},n)}))})}function v(e){let{lazy:n,children:t,selectedValue:o}=e;const a=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=a.find((e=>e.props.value===o));return e?(0,r.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:a.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==o})))})}function j(e){const n=f(e);return(0,x.jsxs)("div",{className:(0,s.A)("tabs-container",b.tabList),children:[(0,x.jsx)(g,{...n,...e}),(0,x.jsx)(v,{...n,...e})]})}function E(e){const n=(0,S.A)();return(0,x.jsx)(j,{...e,children:d(e.children)},String(n))}},6012:(e,n,t)=>{t.d(n,{A:()=>s});t(6540);var r=t(4848);function s(e){let{children:n,color:t}=e;return(0,r.jsx)("span",{style:{backgroundColor:t,borderRadius:"4px",color:"#fff",padding:"0.2rem 0.5rem",fontWeight:"bold"},children:n})}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>i});var r=t(6540);const s={},o=r.createContext(s);function a(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);