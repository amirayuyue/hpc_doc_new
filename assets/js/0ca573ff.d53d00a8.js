"use strict";(self.webpackChunkhpc_doc_new=self.webpackChunkhpc_doc_new||[]).push([[6604],{7100:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var t=i(4848),s=i(8453);i(6540);function o(n){let{children:e,color:i}=n;return(0,t.jsx)("span",{style:{backgroundColor:i,borderRadius:"2px",color:"#fff",padding:"0.2rem"},children:e})}const r={title:"Containerization for HPC",sidebar_position:1,authors:["slorber","yangshun"]},a="Containers on Pinnacles and MERCED",l={id:"running-jobs/singularity",title:"Containerization for HPC",description:"Docusaurus green",source:"@site/docs/running-jobs/singularity.mdx",sourceDirName:"running-jobs",slug:"/running-jobs/singularity",permalink:"/hpc_doc_new/docs/running-jobs/singularity",draft:!1,unlisted:!1,editUrl:"https://github.com/amirayuyue/hpc_doc_new/docs/running-jobs/singularity.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"Containerization for HPC",sidebar_position:1,authors:["slorber","yangshun"]},sidebar:"tutorialSidebar",previous:{title:"Running Matlab",permalink:"/hpc_doc_new/docs/running-jobs/running_matlab"},next:{title:"Tutorial - Extras",permalink:"/hpc_doc_new/docs/category/tutorial---extras"}},c={},d=[{value:"Using Singularity with the Clusters",id:"using-singularity-with-the-clusters",level:2},{value:"Building a Container for use on the Clusters",id:"building-a-container-for-use-on-the-clusters",level:2},{value:"Steps",id:"steps",level:3},{value:"Interacting with Singularity Container",id:"interacting-with-singularity-container",level:2},{value:"Running a container",id:"running-a-container",level:3},{value:"Shell Into the container",id:"shell-into-the-container",level:3},{value:"Execute a command inside container",id:"execute-a-command-inside-container",level:3},{value:"Tips About Using Singularity",id:"tips-about-using-singularity",level:3}];function h(n){const e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...n.components},{Details:r}=e;return r||function(n,e){throw new Error("Expected "+(e?"component":"object")+" `"+n+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o,{color:"#25c2a0",children:"Docusaurus green"}),"\n",(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"containers-on-pinnacles-and-merced",children:"Containers on Pinnacles and MERCED"})}),"\n",(0,t.jsxs)(e.p,{children:["Pinnacles and MERCED ",(0,t.jsx)(e.strong,{children:"do not"})," support Docker images or containers due to security reasons.\nSingularity is an open source container platform that is designed for HPC environments."]}),"\n",(0,t.jsx)(e.h2,{id:"using-singularity-with-the-clusters",children:"Using Singularity with the Clusters"}),"\n",(0,t.jsx)(e.p,{children:"Singularity can be a useful software when you need to have multiple software packages\nand configurations made and distributed for other users to use and collaborate on."}),"\n",(0,t.jsxs)(e.p,{children:["Singularity acts as a software that puts all the specs(softwares,\nenvironment configuration, etc.) into a ",(0,t.jsx)(e.code,{children:"container"}),' that reduces the need for\nconfiguration and other distribution issues.\nThis enhances convenience in sharing and ensures portability, enabling the immediate\nexecution of software "out of the box" within the container.']}),"\n",(0,t.jsx)(e.h2,{id:"building-a-container-for-use-on-the-clusters",children:"Building a Container for use on the Clusters"}),"\n",(0,t.jsx)(e.admonition,{type:"warning",children:(0,t.jsxs)(e.p,{children:["Prerequisite: Create an account with ",(0,t.jsx)(e.a,{href:"cloud.sylabs.io",children:"Sylabs Cloud"}),". This will allow us to create singularity images remotely. Furthermore users can also build definition files of images for other collaborators to access via the cloud."]})}),"\n",(0,t.jsx)(e.h3,{id:"steps",children:"Steps"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:["Create a definition file that contains the instructions to build a configure with the proper packages, softwares and other specs. This ",(0,t.jsx)(e.code,{children:".def"})," file ending denotes a definition file that singularity interprets as an instruction file."]}),"\n",(0,t.jsxs)(r,{children:[(0,t.jsx)("summary",{children:" Click Here for File Example"}),(0,t.jsx)(e.p,{children:"The script below downloads a lightweight version of python and allows for\nthe execution of python commands in the container."}),(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:'    Bootstrap: docker\n    From: python:3.8-slim\n\n    %post\n        apt-get update && apt-get install -y \\\n            build-essential \\\n\n        pip install --upgrade pip\n            pip install numpy pandas matplotlib scipy\n\n    %environment\n        export PATH=/usr/local/bin:$PATH\n\n\n    %runscript\n        exec python "$@"\n\n'})})]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:["Start an interactive session and log into the allocated compute node. For more information on running a interactive session view ",(0,t.jsx)(e.a,{href:"running_jupyter.d",children:"here"})]}),"\n",(0,t.jsx)(e.admonition,{type:"danger",children:(0,t.jsx)(e.p,{children:"All of the following commands must be run on a compute node as they are resource-intensive."})}),"\n",(0,t.jsxs)(e.p,{children:["Because users of Pinnacles and MERCED do not have sudo access, user must create their containers on Singularity's cloud base for all public containers. Refer to prerequisite material to ensure creation and access to ",(0,t.jsx)(e.a,{href:"https://cloud.sylabs.io/dashboard",children:"Sylab Cloud"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:["Run the command ",(0,t.jsx)(e.code,{children:"bash singularity remote login "}),"."]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Now you will be prompted on entering an authorization token from Sylabs. Follow the below guide on generating a token."}),"\n",(0,t.jsxs)(e.p,{children:["a. Click on Access tokens from the Sylab Cloud ",(0,t.jsx)(e.a,{href:"https://cloud.sylabs.io/dashboard",children:"https://cloud.sylabs.io/dashboard"}),"."]}),"\n",(0,t.jsx)(e.p,{children:"b. Enter a simple alias to remember the purpose of creating the token"}),"\n",(0,t.jsx)(e.p,{children:"c. Generate the token"}),"\n",(0,t.jsx)(e.p,{children:"d. The generated token will be displayed here."}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{alt:"Sylab Homepage image",src:i(2880).A+"",title:"Sylab Homepage Image",width:"3008",height:"1038"})}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:["Return to the cluster and enter the following ",(0,t.jsx)(e.code,{children:"singularity remote login"})]}),"\n",(0,t.jsx)(e.p,{children:"Enter in the token displayed."}),"\n",(0,t.jsx)(e.p,{children:"If successful, a message of approval should display"}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:["Build the singularity container from the definition file using the following command: ",(0,t.jsx)(e.code,{children:"singularity build --remote container_name.sif definition_filee.def"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.p,{children:["It will now begin the process of building the container and it may take a few minutes depending on the size and configurations stated in the definition file. All singularity image files will be of type ",(0,t.jsx)(e.code,{children:".sif"})]}),"\n",(0,t.jsxs)(e.ol,{start:"7",children:["\n",(0,t.jsx)(e.li,{children:"The container should now be listed in the current directory."}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"interacting-with-singularity-container",children:"Interacting with Singularity Container"}),"\n",(0,t.jsx)(e.p,{children:"!> All of these commands should still be run on a compute node!"}),"\n",(0,t.jsx)(e.h3,{id:"running-a-container",children:"Running a container"}),"\n",(0,t.jsxs)(e.p,{children:["Use the following command: ",(0,t.jsx)(e.code,{children:"singularity run [container.sif]"})]}),"\n",(0,t.jsx)(e.p,{children:"Running the container, launches an instance of the container application or environment as configured in the build file. What application/environment that will launch from the container will vary."}),"\n",(0,t.jsx)(e.p,{children:"For example, referring to the example build file, the container that was created from that file allows for an interactive python session if the container is being run."}),"\n",(0,t.jsx)(e.h3,{id:"shell-into-the-container",children:"Shell Into the container"}),"\n",(0,t.jsxs)(e.p,{children:["Use the following command: ",(0,t.jsx)(e.code,{children:"singularity shell [container.sif]"})]}),"\n",(0,t.jsx)(e.p,{children:"Running a shell places the user in an interactive command-line interface within the container. Once inside the shell users can run applications and scripts with the softwares installed in the container, test and debug scripts and access files in the container."}),"\n",(0,t.jsx)(e.h3,{id:"execute-a-command-inside-container",children:"Execute a command inside container"}),"\n",(0,t.jsxs)(e.p,{children:["Use the following command: ",(0,t.jsx)(e.code,{children:"singularity exec [container.sif] [command(s)]"})]}),"\n",(0,t.jsx)(e.p,{children:"This allows the user to execute commands in a singularity container without having to enter the container."}),"\n",(0,t.jsx)(e.h3,{id:"tips-about-using-singularity",children:"Tips About Using Singularity"}),"\n",(0,t.jsx)(e.admonition,{type:"tip",children:(0,t.jsx)(e.p,{children:"Files generated and accessible in the container are read-only."})}),"\n",(0,t.jsx)(e.admonition,{type:"tip",children:(0,t.jsx)(e.p,{children:"Singularity does not support root."})}),"\n",(0,t.jsx)(e.admonition,{type:"tip",children:(0,t.jsx)(e.p,{children:"Singularity does support mounting or binding directories on Pinnacles."})})]})}function u(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(h,{...n})}):h(n)}},2880:(n,e,i)=>{i.d(e,{A:()=>t});const t=i.p+"assets/images/sylab2image-6e7c1b862ec28a512c4d56ff9bdc2e4f.png"},8453:(n,e,i)=>{i.d(e,{R:()=>r,x:()=>a});var t=i(6540);const s={},o=t.createContext(s);function r(n){const e=t.useContext(o);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:r(n.components),t.createElement(o.Provider,{value:e},n.children)}}}]);